/*
 * jQuery UI Color Picker @VERSION
 *
 * Copyright (c) 2008 Stefan Petre, Paul Bakaus
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://docs.jquery.com/UI/ColorPicker
 *
 * Depends:
 *	ui.core.js
 */
(function(a){a.widget("ui.colorpicker",{_init:function(){this.charMin=65;var d=this.options,b=this,c='<div class="ui-colorpicker clearfix"><div class="ui-colorpicker-color"><div><div></div></div></div><div class="ui-colorpicker-hue"><div></div></div><div class="ui-colorpicker-new-color"></div><div class="ui-colorpicker-current-color"></div><div class="ui-colorpicker-hex"><label for="ui-colorpicker-hex" title="hex"></label><input type="text" maxlength="6" size="6" /></div><div class="ui-colorpicker-rgb-r ui-colorpicker-field"><label for="ui-colorpicker-rgb-r"></label><input type="text" maxlength="3" size="2" /><span></span></div><div class="ui-colorpicker-rgb-g ui-colorpicker-field"><label for="ui-colorpicker-rgb-g"></label><input type="text" maxlength="3" size="2" /><span></span></div><div class="ui-colorpicker-rgb-b ui-colorpicker-field"><label for="ui-colorpicker-rgb-b"</label><input type="text" maxlength="3" size="2" /><span></span></div><div class="ui-colorpicker-hsb-h ui-colorpicker-field"><label for="ui-colorpicker-hsb-h"></label><input type="text" maxlength="3" size="2" /><span></span></div><div class="ui-colorpicker-hsb-s ui-colorpicker-field"><label for="ui-colorpicker-hsb-s"></label><input type="text" maxlength="3" size="2" /><span></span></div><div class="ui-colorpicker-hsb-b ui-colorpicker-field"><label for="ui-colorpicker-hsb-b"></label><input type="text" maxlength="3" size="2" /><span></span></div><button class="ui-colorpicker-submit ui-default-state" name="submit" type="button">Done</button></div>';if(typeof d.color=="string"){this.color=this._HexToHSB(d.color)}else{if(d.color.r!=undefined&&d.color.g!=undefined&&d.color.b!=undefined){this.color=this._RGBToHSB(d.color)}else{if(d.color.h!=undefined&&d.color.s!=undefined&&d.color.b!=undefined){this.color=this._fixHSB(d.color)}else{return this}}}this.origColor=this.color;this.picker=a(c);if(d.flat){this.picker.appendTo(this.element).show()}else{this.picker.appendTo(document.body)}this.fields=this.picker.find("input").bind("keydown",function(f){return b._keyDown.call(b,f)}).bind("change",function(f){return b._change.call(b,f)}).bind("blur",function(f){return b._blur.call(b,f)}).bind("focus",function(f){return b._focus.call(b,f)});this.picker.find("span").bind("mousedown",function(f){return b._downIncrement.call(b,f)});this.selector=this.picker.find("div.ui-colorpicker-color").bind("mousedown",function(f){return b._downSelector.call(b,f)});this.selectorIndic=this.selector.find("div div");this.hue=this.picker.find("div.ui-colorpicker-hue div");this.picker.find("div.ui-colorpicker-hue").bind("mousedown",function(f){return b._downHue.call(b,f)});this.newColor=this.picker.find("div.ui-colorpicker-new-color");this.currentColor=this.picker.find("div.ui-colorpicker-current-color");this.picker.find(".ui-colorpicker-submit").bind("mouseenter",function(f){return b._enterSubmit.call(b,f)}).bind("mouseleave",function(f){return b._leaveSubmit.call(b,f)}).bind("click",function(f){return b._clickSubmit.call(b,f)});this._fillRGBFields(this.color);this._fillHSBFields(this.color);this._fillHexFields(this.color);this._setHue(this.color);this._setSelector(this.color);this._setCurrentColor(this.color);this._setNewColor(this.color);if(d.flat){this.picker.css({position:"relative",display:"block"})}else{a(this.element).bind(d.eventName+".colorpicker",function(f){return b._show.call(b,f)})}},destroy:function(){this.picker.remove();this.element.removeData("colorpicker").unbind(".colorpicker")},_fillRGBFields:function(b){var c=this._HSBToRGB(b);this.fields.eq(1).val(c.r).end().eq(2).val(c.g).end().eq(3).val(c.b).end()},_fillHSBFields:function(b){this.fields.eq(4).val(b.h).end().eq(5).val(b.s).end().eq(6).val(b.b).end()},_fillHexFields:function(b){this.fields.eq(0).val(this._HSBToHex(b)).end()},_setSelector:function(b){this.selector.css("backgroundColor","#"+this._HSBToHex({h:b.h,s:100,b:100}));this.selectorIndic.css({left:parseInt(150*b.s/100,10),top:parseInt(150*(100-b.b)/100,10)})},_setHue:function(b){this.hue.css("top",parseInt(150-150*b.h/360,10))},_setCurrentColor:function(b){this.currentColor.css("backgroundColor","#"+this._HSBToHex(b))},_setNewColor:function(b){this.newColor.css("backgroundColor","#"+this._HSBToHex(b))},_keyDown:function(b){var c=b.charCode||b.keyCode||-1;if((c>=this.charMin&&c<=90)||c==32){return false}},_change:function(d,c){var b;c=c||d.target;if(c.parentNode.className.indexOf("-hex")>0){this.color=b=this._HexToHSB(this.value);this._fillRGBFields(b.color);this._fillHSBFields(b)}else{if(c.parentNode.className.indexOf("-hsb")>0){this.color=b=this._fixHSB({h:parseInt(this.fields.eq(4).val(),10),s:parseInt(this.fields.eq(5).val(),10),b:parseInt(this.fields.eq(6).val(),10)});this._fillRGBFields(b);this._fillHexFields(b)}else{this.color=b=this._RGBToHSB(this._fixRGB({r:parseInt(this.fields.eq(1).val(),10),g:parseInt(this.fields.eq(2).val(),10),b:parseInt(this.fields.eq(3).val(),10)}));this._fillHexFields(b);this._fillHSBFields(b)}}this._setSelector(b);this._setHue(b);this._setNewColor(b);this._trigger("change",d,{options:this.options,hsb:b,hex:this._HSBToHex(b),rgb:this._HSBToRGB(b)})},_blur:function(c){var b=this.color;this._fillRGBFields(b);this._fillHSBFields(b);this._fillHexFields(b);this._setHue(b);this._setSelector(b);this._setNewColor(b);this.fields.parent().removeClass("ui-colorpicker-focus")},_focus:function(b){this.charMin=b.target.parentNode.className.indexOf("-hex")>0?70:65;this.fields.parent().removeClass("ui-colorpicker-focus");a(b.target.parentNode).addClass("ui-colorpicker-focus")},_downIncrement:function(d){var c=a(d.target).parent().find("input").focus(),b=this;this.currentIncrement={el:a(d.target).parent().addClass("ui-colorpicker-slider"),max:d.target.parentNode.className.indexOf("-hsb-h")>0?360:(d.target.parentNode.className.indexOf("-hsb")>0?100:255),y:d.pageY,field:c,val:parseInt(c.val(),10)};a(document).bind("mouseup.cpSlider",function(f){return b._upIncrement.call(b,f)});a(document).bind("mousemove.cpSlider",function(f){return b._moveIncrement.call(b,f)});return false},_moveIncrement:function(b){this.currentIncrement.field.val(Math.max(0,Math.min(this.currentIncrement.max,parseInt(this.currentIncrement.val+b.pageY-this.currentIncrement.y,10))));this._change.apply(this,[b,this.currentIncrement.field.get(0)]);return false},_upIncrement:function(b){this.currentIncrement.el.removeClass("ui-colorpicker-slider").find("input").focus();this._change.apply(this,[b,this.currentIncrement.field.get(0)]);a(document).unbind("mouseup.cpSlider");a(document).unbind("mousemove.cpSlider");return false},_downHue:function(c){this.currentHue={y:this.picker.find("div.ui-colorpicker-hue").offset().top};this._change.apply(this,[c,this.fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(c.pageY-this.currentHue.y))))/150,10)).get(0)]);var b=this;a(document).bind("mouseup.cpSlider",function(d){return b._upHue.call(b,d)});a(document).bind("mousemove.cpSlider",function(d){return b._moveHue.call(b,d)});return false},_moveHue:function(b){this._change.apply(this,[b,this.fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(b.pageY-this.currentHue.y))))/150,10)).get(0)]);return false},_upHue:function(b){a(document).unbind("mouseup.cpSlider");a(document).unbind("mousemove.cpSlider");return false},_downSelector:function(c){var b=this;this.currentSelector={pos:this.picker.find("div.ui-colorpicker-color").offset()};this._change.apply(this,[c,this.fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(c.pageY-this.currentSelector.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(c.pageX-this.currentSelector.pos.left))))/150,10)).get(0)]);a(document).bind("mouseup.cpSlider",function(d){return b._upSelector.call(b,d)});a(document).bind("mousemove.cpSlider",function(d){return b._moveSelector.call(b,d)});return false},_moveSelector:function(b){this._change.apply(this,[b,this.fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(b.pageY-this.currentSelector.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(b.pageX-this.currentSelector.pos.left))))/150,10)).get(0)]);return false},_upSelector:function(b){a(document).unbind("mouseup.cpSlider");a(document).unbind("mousemove.cpSlider");return false},_enterSubmit:function(b){this.picker.find(".ui-colorpicker-submit").addClass("ui-colorpicker-focus")},_leaveSubmit:function(b){this.picker.find(".ui-colorpicker-submit").removeClass("ui-colorpicker-focus")},_clickSubmit:function(c){var b=this.color;this.origColor=b;this._setCurrentColor(b);this._trigger("submit",c,{options:this.options,hsb:b,hex:this._HSBToHex(b),rgb:this._HSBToRGB(b)});return false},_show:function(g){this._trigger("beforeShow",g,{options:this.options,hsb:this.color,hex:this._HSBToHex(this.color),rgb:this._HSBToRGB(this.color)});var h=this.element.offset();var f=this._getScroll();var d=h.top+this.element[0].offsetHeight;var c=h.left;if(d+176>f.t+Math.min(f.h,f.ih)){d-=this.element[0].offsetHeight+176}if(c+356>f.l+Math.min(f.w,f.iw)){c-=356}this.picker.css({left:c+"px",top:d+"px"});if(this._trigger("show",g,{options:this.options,hsb:this.color,hex:this._HSBToHex(this.color),rgb:this._HSBToRGB(this.color)})!=false){this.picker.show()}var b=this;a(document).bind("mousedown.colorpicker",function(i){return b._hide.call(b,i)});return false},_hide:function(b){if(!this._isChildOf(this.picker[0],b.target,this.picker[0])){if(this._trigger("hide",b,{options:this.options,hsb:this.color,hex:this._HSBToHex(this.color),rgb:this._HSBToRGB(this.color)})!=false){this.picker.hide()}a(document).unbind("mousedown.colorpicker")}},_isChildOf:function(d,c,b){if(d==c){return true}if(d.contains&&!a.browser.safari){return d.contains(c)}if(d.compareDocumentPosition){return !!(d.compareDocumentPosition(c)&16)}var e=c.parentNode;while(e&&e!=b){if(e==d){return true}e=e.parentNode}return false},_getScroll:function(){var e,c,b,f,d,g;if(document.documentElement){e=document.documentElement.scrollTop;c=document.documentElement.scrollLeft;b=document.documentElement.scrollWidth;f=document.documentElement.scrollHeight}else{e=document.body.scrollTop;c=document.body.scrollLeft;b=document.body.scrollWidth;f=document.body.scrollHeight}d=self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0;g=self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0;return{t:e,l:c,w:b,h:f,iw:d,ih:g}},_fixHSB:function(b){return{h:Math.min(360,Math.max(0,b.h)),s:Math.min(100,Math.max(0,b.s)),b:Math.min(100,Math.max(0,b.b))}},_fixRGB:function(b){return{r:Math.min(255,Math.max(0,b.r)),g:Math.min(255,Math.max(0,b.g)),b:Math.min(255,Math.max(0,b.b))}},_HexToRGB:function(b){var b=parseInt(((b.indexOf("#")>-1)?b.substring(1):b),16);return{r:b>>16,g:(b&65280)>>8,b:(b&255)}},_HexToHSB:function(b){return this._RGBToHSB(this._HexToRGB(b))},_RGBToHSB:function(c){var b={};b.b=Math.max(Math.max(c.r,c.g),c.b);b.s=(b.b<=0)?0:Math.round(100*(b.b-Math.min(Math.min(c.r,c.g),c.b))/b.b);b.b=Math.round((b.b/255)*100);if((c.r==c.g)&&(c.g==c.b)){b.h=0}else{if(c.r>=c.g&&c.g>=c.b){b.h=60*(c.g-c.b)/(c.r-c.b)}else{if(c.g>=c.r&&c.r>=c.b){b.h=60+60*(c.g-c.r)/(c.g-c.b)}else{if(c.g>=c.b&&c.b>=c.r){b.h=120+60*(c.b-c.r)/(c.g-c.r)}else{if(c.b>=c.g&&c.g>=c.r){b.h=180+60*(c.b-c.g)/(c.b-c.r)}else{if(c.b>=c.r&&c.r>=c.g){b.h=240+60*(c.r-c.g)/(c.b-c.g)}else{if(c.r>=c.b&&c.b>=c.g){b.h=300+60*(c.r-c.b)/(c.r-c.g)}else{b.h=0}}}}}}}b.h=Math.round(b.h);return b},_HSBToRGB:function(b){var d={};var i=Math.round(b.h);var g=Math.round(b.s*255/100);var c=Math.round(b.b*255/100);if(g==0){d.r=d.g=d.b=c}else{var j=c;var f=(255-g)*c/255;var e=(j-f)*(i%60)/60;if(i==360){i=0}if(i<60){d.r=j;d.b=f;d.g=f+e}else{if(i<120){d.g=j;d.b=f;d.r=j-e}else{if(i<180){d.g=j;d.r=f;d.b=f+e}else{if(i<240){d.b=j;d.r=f;d.g=j-e}else{if(i<300){d.b=j;d.g=f;d.r=f+e}else{if(i<360){d.r=j;d.g=f;d.b=j-e}else{d.r=0;d.g=0;d.b=0}}}}}}}return{r:Math.round(d.r),g:Math.round(d.g),b:Math.round(d.b)}},_RGBToHex:function(b){var c=[b.r.toString(16),b.g.toString(16),b.b.toString(16)];a.each(c,function(d,e){if(e.length==1){c[d]="0"+e}});return c.join("")},_HSBToHex:function(b){return this._RGBToHex(this._HSBToRGB(b))},setColor:function(b){if(typeof b=="string"){b=this._HexToHSB(b)}else{if(b.r!=undefined&&b.g!=undefined&&b.b!=undefined){b=this._RGBToHSB(b)}else{if(b.h!=undefined&&b.s!=undefined&&b.b!=undefined){b=this._fixHSB(b)}else{return this}}}this.color=b;this.origColor=b;this._fillRGBFields(b);this._fillHSBFields(b);this._fillHexFields(b);this._setHue(b);this._setSelector(b);this._setCurrentColor(b);this._setNewColor(b)}});a.extend(a.ui.colorpicker,{defaults:{eventName:"click",color:"ff0000",flat:false}})})(jQuery);